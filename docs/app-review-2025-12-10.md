# Process Point — Functional & Workflow Review (2025-12-10)

## Architecture Overview

- Frontend: React 18 + Vite + React Router + Tailwind
- Data modes: local JSON/localStorage (demo) and Supabase (persistence)
- Integrations: GitHub API for repo file editing and history
- Routing entry: `src/App.tsx` with auth gate; pages for Member, Section Manager, Unit Admin, App Admin

## Core Workflows

- Login: EDIPI/password via local JSON or Supabase; Zustand auth state
- Member Dashboard: shows assigned tasks and “My Items”; generate form submission previews; add tasks to progress
- Section Manager Dashboard: pending actions and archived clearances; conflict check via `sha256(canonicalize(progress))` before sign-off
- Unit Admin Dashboard: manage unit structure (companies/sections), tasks, forms, and unit admin assignments; works in local and Supabase modes
- GitHub Tools: file editor and history views using tokened API calls

## Data Model (Supabase)

- Tables: `users`, `members_progress`, `unit_sections`, `unit_sub_tasks`, `unit_forms`, `my_items`, `my_form_submissions`, `unit_admins`, `unit_admin_assignments`
- Client services map to these tables for users/progress/forms/admin; local mode mirrors shapes via static JSON/localStorage

## Strengths

- End-to-end demo flow runs and demonstrates major roles and actions
- Dual-mode architecture allows local demos with a clear path to persistence
- Conflict detection before sign-off improves data integrity

## Risks & Gaps

- Secrets exposure: a GitHub PAT is present in a Vite env file; client bundling exposes tokens
- Supabase RLS disabled in migrations; missing policies for production
- Password verification in browser; hashed passwords visible in demo JSON
- Write persistence incomplete for sign-offs; audit trails needed
- Sub-task IDs generated by count per section could collide; need constraints and deterministic IDs
- Silent error handling and N+1 fetch patterns in admin pages reduce reliability and scalability
- Role overrides via local storage can diverge from authoritative source

## Recommendations

- Move GitHub operations and password verification server-side; remove client-exposed PATs
- Enable RLS and implement per-role, per-unit access policies across all tables
- Complete sign-off persistence with audit logging; standardize all writes through Supabase
- Add unique constraints and a deterministic ID scheme for `unit_sub_tasks` and related entities
- Centralize error handling with user-visible feedback and logging; batch data fetching server-side
- Unify role sources and reduce `(any)` casts; enforce types via shared schemas

## Validation

- SPA runs locally and routes/auth gate function
- Dual-mode data access verified; conflict detection present pre-write
- GitHub service methods exist and operate via token headers (to be serverized for production)

---

This document captures the current state of functionality and workflows and lists concrete steps to reach production readiness.
